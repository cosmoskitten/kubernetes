# CPU Manager Example

This example flow uses a pre-built docker image based on
[cpuset-visualizer](https://github.com/ConnorDoyle/cpuset-visualizer).
Each container run here hosts an endpoint serving an up-to-the-second
system representation generated by
[`lstopo`](https://www.open-mpi.org/projects/hwloc).

## Setup

1. Start a local cluster with the static CPU manager policy enabled :

   ```
   sudo PATH=$PATH \
     KUBELET_FLAGS="--cpu-manager-policy=static" \
     ./hack/local-up-cluster.sh
   ```

## Run pods

This directory contains convenience scripts to run, delete, and list the
assigned IP addresses of the provided example pods. The example pods are
in the `/examples/cpu-manager` directory of the Kubernetes source tree.
Your ability to run all of the example pods simultaneously depends on how
many CPUs are available on the test system.

The required CPUs for each example pod are listed below:

* `shared.yaml`: 0.1 CPU
* `exclusive-1.yaml`: 1 CPU
* `exclusive-2.yaml`: 2 CPU
* `exclusive-3.yaml`: 3 CPU
* `exclusive-4.yaml`: 4 CPU

To list IP addresses of the pods running in the local cluster, do:

```
$ ./examples/cpu-manager/pod-ips
exclusive-1 http://172.17.0.4
shared http://172.17.0.3
```

**Example:** run a pod with a single container in the shared pool, and
another pod with a single container in an exclusive cpuset with one CPU.

   ```
   $ ./examples/cpu-manager/run shared.yaml --validate=false
   ```

![Sample cpuset-visualizer output](https://user-images.githubusercontent.com/379372/28648573-974693ce-7223-11e7-84ed-17cce11910ff.png)

_Sample cpuset-visualizer output._
